@{
    ViewData["MostrarHeader"] = true;
}

@{
    ViewBag.Title = "Cronograma Semanal";
    Layout = "~/Views/Shared/_Layout.cshtml";

    Dictionary<DateTime, Dictionary<double, INFO_360.Models.Tarea>> agenda = ViewBag.AGENDA;
}
<section class="agenda">
    <div class="container py-4">
        <h2 class="text-center mb-4 st-title">Cronograma Semanal</h2>

        @if (agenda == null || agenda.Count == 0)
        {
            <div class="alert alert-warning text-center st-alert">
                No hay tareas programadas para los próximos 7 días.
            </div>
        }
        else
        {
            <div class="row justify-content-center">

                @foreach (DateTime dia in agenda.Keys.OrderBy(d => d))
                {
                    Dictionary<double, INFO_360.Models.Tarea> tareasDia = agenda[dia];

                    <div class="col-12 col-md-10 col-lg-8 mb-4">
                        <div class="card st-card shadow-sm">

                            <div class="card-header st-card-header">
                                <h4 class="m-0 st-card-title">
                                    @dia.ToString("dddd dd/MM/yyyy")
                                </h4>
                            </div>

                            <div class="card-body">

                                @if (tareasDia == null || tareasDia.Count == 0)
                                {
                                    <p class="text-muted text-center">No hay tareas asignadas para este día.</p>
                                }
                                else
                                {
                                    <div class="table-responsive">
                                        <table class="table table-borderless st-table">
                                            <thead>
                                                <tr>
                                                    <th>Hora</th>
                                                    <th>Tarea</th>
                                                    <th>Duración</th>
                                                </tr>
                                            </thead>

                                            <tbody>
                                                @foreach (double hora in tareasDia.Keys.OrderBy(h => h))
                                                {
                                                    var t = tareasDia[hora];

                                                    if (t != null)
                                                    {
                                                        int hE = (int)Math.Floor(hora);
                                                        int m = (int)((hora - hE) * 60);

                                                        <tr class="st-row">
                                                            <td>@String.Format("{0:00}:{1:00}", hE, m)</td>
                                                            <td>@t.Titulo</td>
                                                            <td>@t.Duracion h</td>
                                                        </tr>
                                                    }
                                                }
                                            </tbody>
                                        </table>
                                    </div>
                                }

                            </div>
                        </div>
                    </div>
                }

            </div>
        }
    </div>
</section>